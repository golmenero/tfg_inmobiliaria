{% extends "base.html" %}

{% block titulo %} {{Property.name}} {% endblock %}

{% block contenido_principal %}

<div class="container">
    <div id="carouselExampleControls" class="carousel slide" data-interval="false">
        <div class="carousel-inner">
            {% for img in property.media %}
            {% if loop.first %}
            <div class="carousel-item active">
                <img class="img-carousel" src={{img}}>
            </div>
            {% else %}
            <div class="carousel-item">
                <img class="img-carousel" src={{img}}>
            </div>
            {% endif %}
            {% endfor %}
        </div>
        <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Anterior</span>
        </a>
        <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Siguiente</span>
        </a>
    </div>
    <h2 class="sectionHeader">Detalles de "{{property.name}}"</h2>

    <!-- DATOS DE PROPIETARIO -->
    {% if user.permission == 'A' || user.permission == 'S' %}
    <div class="div-field-bottom noBorder card">
        <div class="headerButtonOverview card-header">
            <h5 class="mb-0">
                <button type="button" class="buttonOverview btn btn-outline-dark" data-toggle="collapse"
                        data-target="#ownerDetails"
                        aria-expanded="false" aria-controls="ownerDetails">
                    Datos del Propietario
                </button>
            </h5>
        </div>

        <div id="ownerDetails" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
            <div class="card-body">
                <div class="row">
                    <div class="col-12">
                        <h5>Nombre del Propietario: {{property.nameOwner}} {{property.surnameOwner}}<small
                                class="text-muted"> - DNI/NIF/NIE:
                            {{property.dniOwner}}</small>
                        </h5>
                    </div>
                </div>
                <div class="row col-12">
                    <div class="col-4">
                        <p><span class="font-weight-bold">Teléfono: </span>{{property.phoneOwner}}</p>
                    </div>
                    <div class="col-4">
                        <p><span class="font-weight-bold">E-Mail: </span>{{property.emailOwner}}</p>
                    </div>
                    <div class="col-4">
                        <p><span class="font-weight-bold">Dirección: </span>{{property.addressOwner}}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="row">
        <div class="col-8">
            <h4>Precio de {{property.typeOp}}: {{property.price}} €
                {% if property.type == 'vivienda' || property.type == 'local' %}<small class="text-muted"> +
                    {{property.priceCom}} € de Gastos de Comunidad</small>
                {% endif %}
            </h4>
        </div>
        {% if user.permission == 'U' %}
        <div class="d-inline-block col-4">
            {% if user.wishes.includes(property._id.toString()) %}
            <a class="btn btn-success" href="/wishes/delete/{{ property._id.toString() }}"><span
                    class="far fa-heart"></span>
                Eliminar de Mis Deseos
            </a>
            {% else %}
            <form class="inline-form" method="post"
                  action="/wishes/{{ property._id.toString() }}"
                  encType="multipart/form-data">
                <button type="submit" class="btn btn-outline-success"><span class="far fa-heart"></span>
                    Añadir a Mis Deseos
                </button>
            </form>
            {% endif %}
            <button type="button" class="btn btn-secondary"><span class="fas fa-comment-dots"></span>Contactar
            </button>
        </div>
        {% endif %}
    </div>
    <div class="row">
        <div class="col-12">
            <p class="div-field"> {{property.description}}</p>
        </div>
    </div>
    <div class="row">
        {% if property.type == 'vivienda' || property.type == 'local' %}
        <div class="col-6">
            <p><span class="font-weight-bold"> Dirección: </span> {{property.address}}</p>
        </div>
        {% endif %}
        {% if property.type == 'suelo' %}
        <div class="col-6">
            <p><span class="font-weight-bold"> Situacion: </span> {{property.situation}}</p>
        </div>
        {% endif %}
        <div class="col-6">
            <p><span class="font-weight-bold"> Población/Ciudad: </span> {{property.city}}</p>
        </div>
    </div>
    <div class="div-field row ">
        {% if property.type == 'vivienda' %}
        <div class="col-3">
            <div class="row field-icon">
                <span class="fa-3x fas fa-building"> </span>
            </div>
            <div class="row field-icon">
                <h5>{{property.floor}} Piso</h5>
            </div>
        </div>
        <div class="col-3">
            <div class="row field-icon">
                <span class="fa-3x fas fa-ruler-combined"></span>
            </div>
            <div class="row field-icon">
                <h5>{{property.area}} m²</h5>
            </div>
        </div>
        <div class="col-3">
            <div class="row field-icon">
                <span class="fa-3x fas fa-bed"></span>
            </div>
            <div class="row field-icon">
                <h5>{{property.numHabs}} Habs.</h5>
            </div>
        </div>
        <div class="col-3">
            <div class="row field-icon">
                <span class="fa-3x fas fa-toilet"></span>
            </div>
            <div class="row field-icon">
                <h5>{{property.numBan}} Baños</h5>
            </div>
        </div>
        {% endif %}
        {% if property.type == 'local' %}
        <div class="col-4">
            <div class="row field-icon">
                <span class="fa-3x fas fa-building"> </span>
            </div>
            <div class="row field-icon">
                <h5>{{property.floor}} Piso</h5>
            </div>
        </div>
        <div class="col-4">
            <div class="row field-icon">
                <span class="fa-3x fas fa-ruler-combined"></span>
            </div>
            <div class="row field-icon">
                <h5>{{property.area}} m²</h5>
            </div>
        </div>
        <div class="col-4">
            <div class="row field-icon">
                <span class="fa-3x fas fa-toilet"></span>
            </div>
            <div class="row field-icon">
                <h5>{{property.numAseos}} Aseos</h5>
            </div>
        </div>
        {% endif %}
        {% if property.type == 'suelo' %}
        <div class="col-6">
            <div class="row field-icon">
                <span class="fa-3x fas fa-ruler-combined"></span>
            </div>
            <div class="row field-icon">
                <h5>{{property.area}} m²</h5>
            </div>
        </div>
        <div class="col-6">
            <div class="row field-icon">
                <span class="fa-3x fas fa-hammer"></span>
            </div>
            <div class="row field-icon">
                <h5>{{property.edifArea}} Area Edificable</h5>
            </div>
        </div>
        {% endif %}
    </div>
    <div id="divMapContainerDetails" style="display: none;">
        <div class="div-field form-row">
            <div id="divMapaDetails" class="mapLayer col-sm-12">
            </div>
        </div>
    </div>
    <div id="divMapNotLoaded" class="div-field form-row" style="display: none;">
        <div class="alert alert-dark col-md-12" role="alert">
            Esta propiedad no ha podido ser localizada en el mapa. Sentimos las molestias.
        </div>
    </div>

    <h3 class="sectionHeader">Otras Características</h3>

    {% if property.type == 'vivienda' %}
    <div class="div-field row ">
        <!-- GARAJE -->
        {% if property.garaje == 'Si' %}
        <div class="col-2">
            <div class="row field-icon">
                <span class="fa-2x fas fa-car"> </span>
            </div>
            <div class="row field-icon">
                <h6>Garaje</h6>
            </div>
        </div>
        {% else %}
        <div class="opacidadIcono col-2">
            <div class="row field-icon">
                <span class="fa-2x fas fa-car"> </span>
            </div>
            <div class="row field-icon">
                <h6>Garaje</h6>
            </div>
        </div>
        {% endif %}

        <!-- PISCINA -->
        {% if property.piscina == 'Si' %}
        <div class="col-2">
            <div class="row field-icon">
                <span class="fa-2x fas fa-swimming-pool"></span>
            </div>
            <div class="row field-icon">
                <h6>Piscina</h6>
            </div>
        </div>
        {% else %}
        <div class="opacidadIcono col-2">
            <div class="row field-icon">
                <span class="fa-2x fas fa-swimming-pool"></span>
            </div>
            <div class="row field-icon">
                <h6>Piscina</h6>
            </div>
        </div>
        {% endif %}

        <!-- TERRAZA -->
        {% if property.terraza == 'Si' %}
        <div class="col-2">
            <div class="row field-icon">
                <span class="fa-2x fas fa-dungeon"></span>
            </div>
            <div class="row field-icon">
                <h6>Terraza</h6>
            </div>
        </div>
        {% else %}
        <div class="opacidadIcono col-2">
            <div class="row field-icon">
                <span class="fa-2x fas fa-dungeon"></span>
            </div>
            <div class="row field-icon">
                <h6>Terraza</h6>
            </div>
        </div>
        {% endif %}

        <!-- TRASTERO -->
        {% if property.trastero == 'Si' %}
        <div class="col-2">
            <div class="row field-icon">
                <span class="fa-2x fas fa-box-open"></span>
            </div>
            <div class="row field-icon">
                <h6>Trastero</h6>
            </div>
        </div>
        {% else %}
        <div class="opacidadIcono col-2">
            <div class="row field-icon">
                <span class="fa-2x fas fa-box-open"></span>
            </div>
            <div class="row field-icon">
                <h6>Trastero</h6>
            </div>
        </div>
        {% endif %}

        <!-- JARDIN -->
        {% if property.jardin == 'Si' %}
        <div class="col-2">
            <div class="row field-icon">
                <span class="fa-2x fas  fa-leaf"></span>
            </div>
            <div class="row field-icon">
                <h6>Jardín</h6>
            </div>
        </div>
        {% else %}
        <div class="opacidadIcono col-2">
            <div class="row field-icon">
                <span class="fa-2x fas  fa-leaf"></span>
            </div>
            <div class="row field-icon">
                <h6>Jardín</h6>
            </div>
        </div>
        {% endif %}

        <!-- ASCENSOR -->
        {% if property.ascensor == 'Si' %}
        <div class="col-2">
            <div class="row field-icon">
                <span class="fa-2x fas fa-angle-double-up"></span>
            </div>
            <div class="row field-icon">
                <h6>Ascensor</h6>
            </div>
        </div>
        {% else %}
        <div class="opacidadIcono col-2">
            <div class="row field-icon">
                <span class="fa-2x fas fa-angle-double-up"></span>
            </div>
            <div class="row field-icon">
                <h6>Ascensor</h6>
            </div>
        </div>
        {% endif %}
    </div>
    {% endif %}

    {% if property.type == 'vivienda' || property.type == 'local' %}
    <div class="div-field row">
        <!-- CALEFACCION -->
        {% if property.calefaccion == 'Si' %}
        <div class="col-3">
            <div class="row field-icon">
                <span class="fa-2x fas fa-fire-alt"> </span>
            </div>
            <div class="row field-icon">
                <h6>Calefacción</h6>
            </div>
        </div>
        {% else %}
        <div class="opacidadIcono col-3">
            <div class="row field-icon">
                <span class="fa-2x fas fa-fire-alt"> </span>
            </div>
            <div class="row field-icon">
                <h6>Calefacción</h6>
            </div>
        </div>
        {% endif %}
        <!-- AIRE ACONDICIONADO -->
        {% if property.aireAcon == 'Si' %}
        <div class="col-3">
            <div class="row field-icon">
                <span class="fa-2x fas fa-wind"></span>
            </div>
            <div class="row field-icon">
                <h6>Aire Acond.</h6>
            </div>
        </div>
        {% else %}
        <div class="opacidadIcono col-3">
            <div class="row field-icon">
                <span class="fa-2x fas fa-wind"></span>
            </div>
            <div class="row field-icon">
                <h6>Aire Acond.</h6>
            </div>
        </div>
        {% endif %}
        {% endif %}


        {% if property.type == 'vivienda' %}
        <!-- AMUEBLADO -->
        {% if property.amueblado == 'Si' %}
        <div class="col-3">
            <div class="row field-icon">
                <span class="fa-2x fas fa-couch"></span>
            </div>
            <div class="row field-icon">
                <h6>Amueblado</h6>
            </div>
        </div>
        {% else %}
        <div class="opacidadIcono col-3">
            <div class="row field-icon">
                <span class="fa-2x fas fa-couch"></span>
            </div>
            <div class="row field-icon">
                <h6>Amueblado</h6>
            </div>
        </div>
        {% endif %}
        <!-- ANIMALES -->
        {% if property.animales == 'Si' %}
        <div class="col-3">
            <div class="row field-icon">
                <span class="fa-2x fas fa-dog"></span>
            </div>
            <div class="row field-icon">
                <h6>Permite Animales</h6>
            </div>
        </div>
        {% else %}
        <div class="opacidadIcono col-3">
            <div class="row field-icon">
                <span class="fa-2x fas fa-dog"></span>
            </div>
            <div class="row field-icon">
                <h6>Permite Animales</h6>
            </div>
        </div>
        {% endif %}
        {% endif %}


        {% if property.type == 'local' %}
        <!-- ESCAPARATE -->
        {% if property.escaparate == 'Si' %}
        <div class="col-3">
            <div class="row field-icon">
                <span class="fa-2x fas fa-store"></span>
            </div>
            <div class="row field-icon">
                <h6>Escaparate</h6>
            </div>
        </div>
        {% else %}
        <div class="opacidadIcono col-3">
            <div class="row field-icon">
                <span class="fa-2x fas fa-store"></span>
            </div>
            <div class="row field-icon">
                <h6>Escaparate</h6>
            </div>
        </div>
        {% endif %}
        <!-- APARCAMIENTO -->
        {% if property.aparcamiento == 'Si' %}
        <div class="col-3">
            <div class="row field-icon">
                <span class="fa-2x fas fa-parking"></span>
            </div>
            <div class="row field-icon">
                <h6>Aparcamiento</h6>
            </div>
        </div>
        {% else %}
        <div class="opacidadIcono col-3">
            <div class="row field-icon">
                <span class="fa-2x fas fa-parking"></span>
            </div>
            <div class="row field-icon">
                <h6>Aparcamiento</h6>
            </div>
        </div>
        {% endif %}
    </div>
    {% endif %}

    {% if property.type == 'local' %}
    <div class="div-field row">
        {% if property.cargaYdescarga == 'Si' %}
        <!-- CARGA Y DESCARGA -->
        <div class="col-4">
            <div class="row field-icon">
                <span class="fa-2x fas fa-dolly-flatbed"></span>
            </div>
            <div class="row field-icon">
                <h6>Carga y Descarga</h6>
            </div>
        </div>
        {% else %}
        <div class="opacidadIcono col-3">
            <div class="row field-icon">
                <span class="fa-2x fas fa-dolly-flatbed"></span>
            </div>
            <div class="row field-icon">
                <h6>Carga y Descarga</h6>
            </div>
        </div>
        {% endif %}
        <!-- EXTINTORES -->
        {% if property.extintores == 'Si' %}
        <div class="col-4">
            <div class="row field-icon">
                <span class="fa-2x fas fa-fire-extinguisher"></span>
            </div>
            <div class="row field-icon">
                <h6>Extintores</h6>
            </div>
        </div>
        {% else %}
        <div class="opacidadIcono col-3">
            <div class="row field-icon">
                <span class="fa-2x fas fa-fire-extinguisher"></span>
            </div>
            <div class="row field-icon">
                <h6>Extintores</h6>
            </div>
        </div>
        {% endif %}
        <!-- ILUMINACION -->
        {% if property.iluminacion == 'Si' %}
        <div class="col-4">
            <div class="row field-icon">
                <span class="fa-2x fas fa-lightbulb"></span>
            </div>
            <div class="row field-icon">
                <h6>Iluminación</h6>
            </div>
        </div>
        {% else %}
        <div class="opacidadIcono col-3">
            <div class="row field-icon">
                <span class="fa-2x fas fa-lightbulb"></span>
            </div>
            <div class="row field-icon">
                <h6>Iluminación</h6>
            </div>
        </div>
        {% endif %}
    </div>
    {% endif %}

    {% if property.type == 'suelo' %}
    <div class="div-field row">
        <!-- ACCESO A AGUA -->
        {% if property.accesoAgua == 'Si' %}
        <div class="col-6">
            <div class="row field-icon">
                <span class="fa-2x fas fa-hand-holding-water"> </span>
            </div>
            <div class="row field-icon">
                <h6>Acceso a Agua</h6>
            </div>
        </div>
        {% else %}
        <div class="opacidadIcono col-3">
            <div class="row field-icon">
                <span class="fa-2x fas fa-hand-holding-water"> </span>
            </div>
            <div class="row field-icon">
                <h6>Acceso a Agua</h6>
            </div>
        </div>
        {% endif %}
        <!-- ACCESO A LUZ -->
        {% if property.accesoLuz == 'Si' %}
        <div class="col-6">
            <div class="row field-icon">
                <span class="fa-2x fas fa-lightbulb"></span>
            </div>
            <div class="row field-icon">
                <h6>Acceso a Luz</h6>
            </div>
        </div>
        {% else %}
        <div class="opacidadIcono col-3">
            <div class="row field-icon">
                <span class="fa-2x fas fa-lightbulb"></span>
            </div>
            <div class="row field-icon">
                <h6>Acceso a Luz</h6>
            </div>
        </div>
        {% endif %}
    </div>
    {% endif %}

</div>
<script>
    $(document).ready(writeMap());

    function writeMap() {
        let address = "{{property.address}}";
        $.get(location.protocol + '//nominatim.openstreetmap.org/search?format=json&q=' + address, function (data) {
            if (data[0] != undefined) {
                $('#divMapaDetails').innerHTML = "";
                $('#divMapContainerDetails').show();
                $('#divMapNotLoaded').hide();
                let lattitude = data[0].lat;
                let longitude = data[0].lon;

                let mapaLocal = L.map('divMapaDetails');
                mapaLocal.setView([lattitude, longitude], 13);

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(mapaLocal);

                marker = L.marker([lattitude, longitude]);
                marker.addTo(mapaLocal);

            } else {
                let type = '{{property.type}}'
                if (type != 'suelo')
                    $('#divMapNotLoaded').show();
            }
        });
    }
</script>
</div>
{% endblock %}